<script type="text/template" id="template-channel-list">
	<a href="/#channel/create">
		create a channel
	</a> <br />
	<div class="dropdown-divider"></div>
	<div class="list-group">
		<%% _.each(channels, function(channel) { %>
			<a href="/#channel/<%%e channel.id %>" class="list-group-item list-group-item-action">
				<div class="d-flex w-100 justify-content-between">
					<h5 class="mb-1"><%%e channel.name %></h5>
					<small><%%e channel.visibility %></small>
				</div>
				<small>owner by <%%e channel.owner.username %></small>
			</a>
		<%% }); %>
	</div>
</script>

<script type="text/template" id="template-channel-create">
	<form id="channel-form" autocomplete="off">
		<div class="form-group has-validation">
			<label for="name-input">Name</label>
			<input class="form-control" id="name-input" value="<%%e name %>" autocomplete="off">
			<div id="name-invalid" class="invalid-feedback"></div>
		</div>
		<div class="form-group has-validation">
			<label for="visibility-input">Visibility</label>
			<select class="form-control" id="visibility-select">
				<option value="public" <%%e visibility == "public" ? 'selected' : '' %>>Public</option>
				<option value="protected" <%%e visibility == "protected" ? 'selected' : '' %>>Protected <small>(require a password)</small></option>
				<option value="private" <%%e visibility == "private" ? 'selected' : '' %>>Private</option>
			</select>
			<div id="visibility-invalid" class="invalid-feedback"></div>
		</div>
		<div class="form-group has-validation" style="display: none" id="password-form-group">
			<label for="password-input">Password (leave empty to not change it)</label>
			<input type="password" class="form-control" id="password-input" value="<%%e this.password %>" autocomplete="new-password">
			<div id="password-invalid" class="invalid-feedback"></div>
		</div>
	</form>
	<div class="text-center">
		<button type="button" class="btn btn-primary" id="submit-button">submit</button>
	</div>
</script>

<script type="text/template" id="template-channel-loading">
	<div class="text-center">
		<div class="spinner-border" role="status">
			<span class="sr-only">loading...</span>
		</div>
	</div>
</script>

<script type="text/template" id="template-channel-error">
	<div class="alert alert-danger" role="alert">
		<%% if (status == 403) { %>
			forbidden: <%%e message %>
		<%% } else if (status == 404) { %>
			not found
		<%% } else if (status == 0) { %>
			error: no status
		<%% } else { %>
			error: <%%e message %>
		<%% } %>
		<small>
			<a id="refresh" href="javascript:void(0)" class="alert-link">(click here to refresh)</a>
		</small>
	</div>
</script>

<script type="text/template" id="template-channel-password-protected">
	<div class="alert alert-warning" role="alert">
		password protected
		<small>
			<a id="refresh" href="javascript:void(0)" class="alert-link">(click here to refresh)</a>
		</small>
	</div>
	<%% if (error) { %>
		<div class="alert alert-danger mb-3" role="alert">
			error: <%%e error.responseJSON?.message || error.status %>
		</div>
	<%% } %>
	<div class="input-group mb-3">
		<input id="password-input" type="password" class="form-control" placeholder="password">
		<div class="input-group-append">
			<button id="submit-button" class="btn btn-primary">submit</button>
		</div>
	</div>
</script>

<script type="text/template" id="template-channel-private">
	<div class="alert alert-danger" role="alert">
		private
		<small>
			<a id="refresh" href="javascript:void(0)" class="alert-link">(click here to refresh)</a>
		</small>
	</div>
</script>

<script type="text/template" id="template-channel-member">
	<p class="channel-member">
		<%%e member.user.username %>
		<%% if (member.user.id == channelOwner.id) { %>
			<i class="mdi mdi-crown" aria-hidden="true"></i>
		<%% } %>
		<%% if (member.admin) { %>
			<i class="mdi mdi-account-supervisor" aria-hidden="true"></i>
		<%% } %>
		<%% if (member.muted) { %>
			<i class="mdi mdi-volume-mute" aria-hidden="true"></i>
		<%% } %>
	</p>
</script>

<script type="text/template" id="template-channel-message-list">
	<div id="message-container" style="height: 300px; overflow-y: scroll">
		<!-- items -->
	</div>
	
	<div class="dropdown-divider"></div>
	<div class="input-group">
		<input id="message-input" type="text" class="form-control" placeholder="hello world">
		<div class="input-group-append">
			<button id="send-button" class="btn btn-primary">
				<i class="mdi mdi-send" aria-hidden="true"></i>
			</button>
		</div>
	</div>
</script>

<script type="text/template" id="template-channel-message">
	<div class="channel-message">
		<a href="#user/<%%e user.id %>"><%%e user.username %></a>: <%%e content %>
	</div>
</script>

<script type="text/template" id="template-channel">
	<%% if (state.loading) { %>
		<div class="text-center">
			<div class="spinner-border" role="status">
				<span class="sr-only">Loading...</span>
			</div>
		</div>
	<%% } else if (state.error) { %>
		<div class="alert alert-danger" role="alert">
			<%% if (state.error.status == 403) { %>
				forbidden: <%%e state.error.responseJSON.message %>
			<%% } else if (state.error.status == 404) { %>
				not found
			<%% } else if (state.error.status == 0) { %>
				error
			<%% } else { %>
				error: <%%e state.error.responseJSON.message %>
			<%% } %>
			<small>
				<a id="error-refresh" href="javascript:void(0)" class="alert-link">(click here to refresh)</a>
			</small>
		</div>
	
		<%% if (state.error?.responseJSON?.message === "password protected") { %>
			<div class="input-group mb-3">
				<input id="password-input" type="password" class="form-control" placeholder="password">
				<div class="input-group-append">
					<button id="submit-password-button" class="btn btn-primary">submit</button>
				</div>
			</div>
		<%% } %>
	<%% } else { %>
		<%% if (!state.connected) { %>
			<div class="alert alert-warning" role="alert">
				not connected, connecting...
			</div>
		<%% }%>
		<h3>
			<%%e channel.name %>
			<small class="text-muted"><%%e channel.visibility %></small>
		</h3>
		<div class="dropdown-divider"></div>
		<div>
			<%% if (channel.owner && user_signed_in && current_user.id == channel.owner.id) { %>
				<a href="#channel/<%%e channel.id %>/edit">[edit]</a>
				<a href="#channel/<%%e channel.id %>/transfer-ownership">[transfer-ownership]</a>
				<a href="#channel/<%%e channel.id %>/delete">[delete]</a>
			<%% } %>
			<a id="leave-link" href="javascript:void(0)">[leave]</a>
		</div>
		<div class="dropdown-divider"></div>
		<div class="container">
			<div id="part-container" class="row">
				<div id="messages-part" class="col-12 col-lg-10"></div>
				<div id="members-part" class="col-0 col-lg-2"></div>
			</div>
		</div>
	<%% } %>
</script>
